<%= render 'shared/banner_index' %>
<%#= render 'shared/banner' %>
<div class="bg-white">
  <div class="d-flex justify-content-center container-fluid">
    <div class="icon-categories bt-1 d-flex justify-content-around flex-wrap">
      <% Product.category_options_for_select.each do |category| %>
        <%= link_to shops_path(category: category) do %>
          <%= cl_image_tag( category , crop: :fill, class:"rounded single-icon") %>
          <p id="p-icons"><%= category.capitalize %></p>
        <% end %>
      <% end %>
    </div>
  </div>
  <%# SI EL USER ESTA CONECTADO LE MUESTRO CERCA TUYO!!  %>
  <% if user_signed_in? %>
    <div class="wrapper_index">
      <h4 class="text-center pb-2 mt-4">Platos mas cercanos</h4>
      <div class="cards_index dragscroll">
        <% @products.each do |product| %>
            <div class="card_product_index">
              <div class="card-img-top position-relative">
                <% if product.photo.attached? %>
                  <%= cl_image_tag product.photo.key, height:300, width:300, crop: :fill %>
                <% else %>
                  <%= cl_image_tag("mojito_baggco", height:300, width:300, crop: :fill) %>
                <% end %>
              </div>
              <div class="p-3">
                <h4 class="m-0"><%= product.name %> </h4>
              </div>
               <p class=" m-0 d-flex justify-content-center mb-1"> <i class="fas fa-map-marker" id="icono_localizacion"></i> <%=product.shop.distance_from(current_user) %></p>
              <div class="text-center">
                <% if current_user.active_cart.nil? %>
                    <%= link_to "Agregar al Carrito", product_cart_items_path(product), method: :POST, class:"btn btn-primary btn-block"%>
                <% else %>
                  <% if current_user.active_cart.shop == @shop %>
                    <% if cart_item = current_user.active_cart.cart_items.find { |item| item.product == product } %>
                      <%= link_to "Agregar otro", increase_cart_item_path(cart_item), method: :PATCH, class:"btn btn-primary btn-block"%>
                    <% else %>
                      <%= link_to "Agregar al Carrito", product_cart_items_path(product), method: :POST, class:"btn btn-primary btn-block"%>
                    <% end %>
                  <% else %>
                    <%= link_to "Agregar al Carrito", product_cart_items_path(product), method: :POST, data: { confirm: 'Tu carrito tiene productos de otro shop, si deseas continuar seran removidos!' }, class:"btn btn-primary btn-block"%>
                  <% end %>
                <% end %>
              </div>
            </div>
          <% end %>
      </div>
    </div>
    <%# Locales cercanos !!  %>
    <div class="wrapper_index">
      <h4 class="text-center pb-2">Locales cercanos</h4>
      <div class="cards_index dragscroll">
        <% @shops.each do |shop| %>
          <%= link_to shop_path(shop) do %>
            <div class="card_product_index">
              <div class="card-img-top position-relative">
                <div class="heart">
                  <i class="fas fa-heart"></i>
                </div>
                <% if shop.photo.attached? %>
                  <%= cl_image_tag shop.photo.key, height:300, width:300, crop: :fill %>
                <% else %>
                  <%= cl_image_tag("mojito_baggco", height:300, width:300, crop: :fill) %>
                <% end %>
              </div>
              <div class="p-3">
              <h4><% shop.name %> </h4>
              <div class="rating">
                <% if shop.rating.nil? %>
                  <% 5.times do %>
                    <i class="far fa-star"></i>
                  <% end %>
                <% else %>
                  <% shop.rating.times do  %>
                    <i class="fas fa-star"></i>
                  <% end %>
                  <% (5 - shop.rating).times do %>
                    <i class="far fa-star"></i>
                  <% end %>
                <% end %>
              </div>
                <p class=" m-0 d-flex justify-content-center"> <i class="fas fa-map-marker" id="icono_localizacion"></i> <%=shop.distance_from(current_user) %></p>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>


    <%# DESTACADOS !! ( SE MUESTRA SIEMPRE) %>
    <div class="wrapper_index">
      <h4 class="text-center pb-2">Destacados</h4>
      <div class="cards_index dragscroll">
        <% @destacados.each do |shop| %>
          <%= link_to shop_path(shop) do %>
            <div class="card_product_index">
              <div class="card-img-top position-relative">
                <div class="heart">
                  <i class="fas fa-heart"></i>
                </div>
                 <% if shop.photo.attached? %>
                  <%= cl_image_tag shop.photo.key, height:300, width:300, crop: :fill %>
                <% else %>
                  <%= cl_image_tag("mojito_baggco", height:300, width:300, crop: :fill) %>
                <% end %>
              </div>
              <div class="p-3">
              <h4><%= shop.name %> </h4>
              <div class="rating">
                <% if shop.rating.nil? %>
                  <% 5.times do %>
                    <i class="far fa-star"></i>
                  <% end %>
                <% else %>
                  <% shop.rating.times do  %>
                    <i class="fas fa-star"></i>
                  <% end %>
                  <% (5 - shop.rating).times do %>
                    <i class="far fa-star"></i>
                  <% end %>
                <% end %>
              </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>

</div>
